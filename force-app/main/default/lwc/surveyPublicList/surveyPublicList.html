<template>
  <!-- HEADER -->
  <header class="header">
    <div class="container header__container">
      <div class="header__logo">
        <img src={logoUrl} alt="Survey360 Logo" class="header__img" />
      </div>
      <nav class="header__nav">
        <ul class="nav__list">
          <li><a href="/" class="nav__link">Home</a></li>
          <li><a href="/survey-list" class="nav__link">Surveys</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero hero--market">
    <div class="container hero__wrap">
      <span class="hero__badge reveal">
        <svg class="icon-16" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 2l1.6 4.3L18 8l-4.4 1.7L12 14l-1.6-4.3L6 8l4.4-1.7L12 2z" fill="currentColor"/>
        </svg>
        Cutting-Edge Survey Platform
      </span>

      <h1 class="market__title">
        <span class="market__line market__line--top text-gradient reveal">Survey</span>
        <span class="market__line market__line--bottom reveal">Marketplace</span>
      </h1>

      <p class="hero__subtitle hero__subtitle--center reveal">
        Discover groundbreaking surveys from industry leaders and contribute your valuable
        insights to shape the future of business, technology, and society.
      </p>

      <div class="market__search reveal">
        <input type="text" class="market__input" placeholder="Search surveys by topic, category, or keyword..." />
      </div>
    </div>
  </section>

  <!-- METRICS -->
  <section class="metrics">
    <div class="container metrics__grid">
      <article class="metric-card reveal">
        <div class="metric__icon">
          <svg viewBox="0 0 24 24" width="28" height="28" fill="none" aria-hidden="true">
            <path d="M12 7c4.418 0 8 5 8 5s-3.582 5-8 5-8-5-8-5 3.582-5 8-5Z" stroke="#8c52ff" stroke-width="2"/>
            <circle cx="12" cy="12" r="2.2" fill="#8c52ff" opacity=".9"/>
          </svg>
        </div>
        <div class="metric__value">{activeCount}</div>
        <div class="metric__label">Active Surveys</div>
        <div class="metric__caption">Ready to participate</div>
      </article>

      <article class="metric-card reveal">
        <div class="metric__icon">
          <svg viewBox="0 0 24 24" width="28" height="28" fill="none" aria-hidden="true">
            <path d="M16 11a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z" stroke="#8c52ff" stroke-width="2"/>
            <path d="M3 20c1.5-3.5 4.5-5.5 9-5.5s7.5 2 9 5.5" stroke="#8c52ff" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="metric__value">{totalResponses}</div>
        <div class="metric__label">Total Responses</div>
        <div class="metric__caption">Community contributions</div>
      </article>

      <article class="metric-card reveal">
        <div class="metric__icon">
          <svg viewBox="0 0 24 24" width="28" height="28" fill="none" aria-hidden="true">
            <path d="M7 4h10l2 4-7 12L5 8l2-4Z" stroke="#8c52ff" stroke-width="2" stroke-linejoin="round"/>
            <path d="M12 8v3" stroke="#8c52ff" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="metric__value">{avgEngagement}</div>
        <div class="metric__label">Avg. Engagement</div>
        <div class="metric__caption">Per survey</div>
      </article>
    </div>
  </section>

  <!-- FILTERS -->
  <section class="filters">
    <div class="container">
      <div class="filters__row">
        <button class="f-btn reveal" data-type="categories" onclick={handleFilterClick}>
          <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
            <path d="M3 5h18M6 12h12M10 19h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <span>Categories</span>
        </button>
        <button class="f-btn reveal" data-type="sort" onclick={handleFilterClick}>
          <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
            <path d="M8 4v16M8 20l-3-3m3 3l3-3M16 4l3 3m-3-3l-3 3M16 20V4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Sort by</span>
        </button>
        <button class="f-btn reveal" data-type="trending" onclick={handleFilterClick}>
          <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
            <path d="M3 17l6-6 4 4 7-7" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Trending</span>
        </button>
      </div>
    </div>
  </section>

  <!-- CARDS -->
  <section class="catalog">
    <div class="container">
      <!-- use computed full class string -->
      <div class={gridClass}>
        <template for:each={visibleSurveys} for:item="s">
          <article key={s.Id} class="s-card reveal">
            <div class="s-card__row">
              <div class="s-card__leftchips">
                <template if:true={s.Category__c}>
                  <span class="chip chip--cat">
                    {s.Category__c}
                  </span>
                </template>
              </div>
              <span class="chip chip--state">
                <svg viewBox="0 0 24 24" width="14" height="14" aria-hidden="true">
                  <path d="M20 6l-11 11-5-5" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
                </svg>
                Active
              </span>
            </div>

            <h3 class="s-card__title">{s.Survey_Name__c}</h3>
            <p class="s-card__desc" title={s.Description__c}>{s.shortDesc}</p>

            <div class="s-card__stats">
              <div class="stat">
                <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                  <path d="M8 11h8M12 7v8" stroke="#64748b" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <div class="stat__body">
                  <span class="stat__label">Responses</span>
                  <span class="stat__value">{s.Response_Count__c}</span>
                </div>
              </div>
              <div class="stat">
                <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                  <path d="M12 8v4l3 2" stroke="#64748b" stroke-width="2" stroke-linecap="round"/>
                  <circle cx="12" cy="12" r="8" stroke="#64748b" stroke-width="2" fill="none"/>
                </svg>
                <div class="stat__body">
                  <span class="stat__label">Duration</span>
                  <span class="stat__value">{s.Duration_Minutes__c} min</span>
                </div>
              </div>
              <div class="stat">
                <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                  <path d="M7 4h10l2 4-7 12L5 8l2-4Z" stroke="#64748b" stroke-width="2" stroke-linejoin="round"/>
                </svg>
                <div class="stat__body">
                  <span class="stat__label">Published</span>
                  <span class="stat__value">{s.Published_Date__c}</span>
                </div>
              </div>
            </div>

            <div class="s-card__divider"></div>

            <button class="s-card__btn" data-id={s.Id} onclick={handleTakeSurvey}>
              <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                <path d="M12 17l-1.5-1.5 3.5-3.5H6v-2h8l-3.5-3.5L12 5l6 6-6 6z" fill="currentColor"/>
              </svg>
              <span>Take Survey</span>
            </button>
          </article>
        </template>
      </div>

      <template if:true={showLoadMore}>
        <div class="loadmore">
          <button class="loadmore__btn" onclick={handleLoadMore}>Load More Surveys</button>
        </div>
      </template>
    </div>
  </section>
</template>
